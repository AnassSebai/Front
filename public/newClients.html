<!DOCTYPE html>
<html>
  <head>
    <title>Ajouter un client</title>
    <meta http-equiv="Content-Security-Policy" content="block-all-mixed-content">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script type="text/javascript" src="ajouter.js"></script>
    <link rel="stylesheet" type="text/css" href="formulaireStyle.css">
  </head>
  <body>
    <h1>Ajouter un client</h1>
    <form id="newClientForm" action="/api/customers" method="post">
      <label for="last">Nom :</label>
      <input type="text" id="last" name="last" required><br>
      <label for="first">Prenom :</label>
      <input type="text" id="first" name="first" required><br>
      <label for="company">Societe :</label>
      <input type="text" id="company" name="company" required><br>
      <label for="country">Pays :</label>
      <input type="text" id="country" name="country" required><br><br>
      <label for="email">Email :</label>
      <input type="email" id="email" name="email" required><br><br>
      <button style="background-color: rgb(169, 85, 85);  right:0;" type="submit"
      class="btn btn-primary">Valider</button>

    </form>
  </body>
  <script>
    //first we get the last id of the clients
    //then we add 1 to it to get the new id
    //we then add the new client to the database
    //by sending a POST request to the API of apiPres.js
    var url = new URL("http://localhost:3001/api/clients");
    var lastId;
    var newId;
    var newClient;
    function getLastId() {
      $.ajax({
        url: url,
        type: 'GET',
        success: function (data) {
          lastId = data[data.length - 1].id;
          newId = lastId + 1;
          console.log(newId);
        }
      });
    }
    getLastId();
    function addClient() {
      newClient = {
        id: newId,
        last: document.getElementById("last").value,
        first: document.getElementById("first").value,
        company: document.getElementById("company").value,
        country: document.getElementById("country").value,
        email: document.getElementById("email").value
      };
      $.ajax({
        url: url,
        type: 'POST',
        data: newClient,
        success: function (data) {
          console.log(data);
          //message de confirmation
          alert("Client ajouté avec succès");
        },
        error: function (data) {
          console.log(data);
          //message d'erreur
          alert("Erreur lors de l'ajout du client");
        }
      });
    }
    $(document).ready(function () {
      $("#newClientForm").submit(function (e) {
        e.preventDefault();
        addClient();
      });
    });

  </script>
</html>
