<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="supprimerClient.css">
  <title>Supprimer un client</title>
  
</head>

<body>
  <nav>
    <ul>
      <li><a href="index.html">Liste des clients</a></li>
      <li><a href="newClients.html">Ajouter un client</a></li>
      <li><a href="supprimerClient.html">Supprimer un client</a></li>
    </ul>
  </nav>
  
  <div class="d-flex justify-content-center">
    <form style="width:30rem; position:relative; top:2rem;">
      <div class="col">
        <input type="id" class="form-control" id="id" placeholder="Saisissez l'id du client Ã  retirer">
      </div>
      <br>
      <div class="row">
        <div class="col-sm-12">
          <button type="submit" class="btn btn-primary">Supprimer</button>
        </div>
      </div>
    </form>
  </div>

  <script>
    const form = document.querySelector('form');
    form.addEventListener('submit', SupprimerClient);
    var url = new URL("http://localhost:3001/api/clients");

    function getTotalClients() {
      //on recupere le nombre de clients
      let nbclients;
      $.ajax({
        url: url,
        async: false,
        success: function(data) {
          nbclients = data.total;
        }
      });
      return nbclients;
    }

    function SupprimerClient(event) {
      //Preventing page refresh
      event.preventDefault();
      let id = parseInt(document.getElementById("id").value);
      //on recupere l'url et on la transforme en objet url
      var search_params = url.searchParams;
      search_params.set("id", id);
      // replace current query string with new params
      url.search = search_params.toString();
      //on envoie le client au serveur
      $.ajax({
        url: url,
        method: "DELETE",
        success: function(response) {
          alert(response.message);
        }
      });
    }
  </script>

</body>

</html>
